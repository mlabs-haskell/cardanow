# Clean Up

The service produces a significant amount of data, including downloaded mithril snapshots, which can lead to substantial disk usage growth. To mitigate this, we implement mechanisms to prevent linear growth of disk usage with the number of exports. We divide the problem into three subproblems:

- **Local Data:** This refers to data generated locally, primarily for development and testing purposes.
- **Service-Host Data:** This includes data generated by the service to produce the actual data it provides, such as downloaded mithril snapshots and intermediate databases.
- **Cloud Data:** This is the data we serve, for example, downloadable kupo snapshots.

## Cleaning Up Local Data

We provide a simple script that essentially deletes all folders prone to size growth. This script must be executed manually:

```bash
./bin/cleanup-local-data.sh <files_to_keep> <list_of_dirs>
```

So for example, given the config default at the time of writing, we can clean up dirs using the following:
```bash
./bin/cleanup-local-data.sh 3 kupo-data/{preview,preprod,mainnet} exported-snapshots/{preview,preprod,mainnet} mithril-snapshots/{preview,preprod,mainnet}
```
## Cleaning Up Service-Host Data
This process is more complex due to the possibility of system interruptions and data upload failures. To address this, we adopt a simple but effective approach: retaining only the three most recent files in directories prone to size growth. For instance, if we are storing mithril snapshots for mainnet in `MITHRIL_SNAPSHOTS_BASE_DIR`, we regularly check to ensure that we have at most three snapshots, including the most recent one.

Technically, this is accomplished by running a systemd daemon that executes the cleanup script every 6 hours. The script 

## Cleaning Up Cloud Data
Cloud data, which we serve, follows a similar approach to cleaning up service-host data. The only distinction is that we utilize a third-party API for deletion, as this data is stored on another machine.

Technically, this is achieved by running a systemd daemon that executes the cleanup script every 6 hours.

